# Excel 加载项功能说明

## 基础功能

### 法定假期查询  
提供 `LegalRestDay` 函数，支持通过以下参数获取数据：  
- **输入日期**：返回该日期之后的所有法定假期  
- **输入年份（2010-2100）**：返回指定年份的假期  
- **输入负整数**：返回过去 N 个月至未来 12 个月的假期（默认 6 个月）  
- **输入 0**：返回原始数据表内容  

### 数据自动同步  
通过 GitHub 仓库维护的标准化数据源（CSV 格式）实现动态更新：  
- 每年 12 月自动预载下一年度数据  
- 自动跳过本地已存在的年份数据  
- 更新后自动排序并保存  

---

## 实现方式

### 数据存储  
- 数据存储在 `LegalDays` 工作表，格式为日期序列值  
- 配置信息记录在 `Config` 工作表，包含更新日志和同步记录  

### 网络交互  
- 使用 `MSXML2.ServerXMLHTTP` 组件进行数据请求  
- 超时设定：5 秒连接/发送，10 秒接收  
- 支持通过代理服务器访问（系统默认设置）  

### 错误处理  
- 错误日志记录在配置表 `D` 列  
- 自动限制日志条目数量（最大保留 30 条）  

---

## 使用限制

### 环境需求  
- 需要启用 Excel 宏功能    

### 数据范围  
- 基础数据覆盖 2011 年至今  
- 数据更新频率依赖维护者提交至 GitHub 仓库  

---

## 典型应用场景

```vbscript
' 获取当前日期之后的所有假期
=LegalRestDay(TODAY())

' 获取 2024 年全年假期
=LegalRestDay(2024)

' 获取过去3个月至未来12个月的假期
=LegalRestDay(-3)
```

---

# 注意事项

- 数据更新在工作簿打开时自动触发（需保持网络连接）

- 无网络环境可继续使用本地已有数据

- 同步失败时不影响历史数据调用
